# 제 5장. HTTP 와 연계하는 웹 서버
## 5.1. 1대로 멀티 도메인을 가능하게 하는 가상 호스트
- HTTP/1.1 에서는 하나의 서버에 여러개의 웹 사이트를 실행할수 있다.
  - ex) 웹 호스팅을 제공하고 있는 사업자
  - 이를 위해 ``가상호스트` 라는 기능을 사용하고 있다.
- 가상호스트를 사용하면 **물리적으로는 서버가 1대지만 가상으로 여러대가 있는 것처럼 설정하는 것이 가능**하다.
- 인터넷에서 도메인명은 DNS에 의해 IP 주소로 변환되고 나서 액세스한다. <br>결국 요청이 서버에 도착하는 시점에는 IP주소를 기준으로 접근하게 된다.
- 이때 가상호스트를 사용하고 있다면, 1대의 물리적 서버 에서 두개의 도메인이 있을경우 서버는 어느 쪽에 대한 접근인지 알 수가 없다.
  - 같은 서버 상에, 같은 IP 주소의 웹 서버에서 2개의 도메인이 실행되고 있을 때 DNS로 이름을 해결할 수 없다.
- HTTP 요청시에 **호스트명과 도메인명을 완전하게 포함한 URI를 지정**하거나, 반드시 Host 헤더필드에서 지정해야한다.
![](image.png)

## 5.2. 통신을 중계하는 프로그램 : 프록시, 게이트웨이, 터널
- HTTP는 클라이언트와 서버 이외에 프록시, 게이트웨이, 터널과 같은 통신을 중계하는 프로그램과 서버를 연계하는 것도 가능하다
- 프록시
  - 서버와 클라이언트의 양쪽 역할을 하는 중계 프로그램
  - 클라이언트 요청을 서버에 전송하고, 서버의 응답을 클라이언트에 전송한다
- 게이트웨이
  - 다른 서버를 중계하는 서버
  - 클라이언트로부터 수신한 요청을 리소스를 보유한 서버인 것처럼 수신한다
- 터널
  - 서로 떨어진 2대의 클라이언트와 서버 사이를 중계하며 접속을 주선하는 중계 프로그램

### 5.2.1. 프록시
- 프록시 서버의 기본 동작은 클라이언트로부터 받은 요청을 다른 서버에 전송하는 것이다
- 오리진 서버 : 리소스 본체를 가진 서버
- HTTP 통신을 할 때, 프록시 서버를 여러 대 경유하는 것도 가능하다
  - **중계할 때에는 Via 헤더필드에 경유한 호스트 정보를 추가**해야 한다
- 프록시 서버를 사용하는 이유
  - 캐시를 사용한 네트워크 대역을 효율적으로 사용하는 것
  - 조직 내에서 특정 웹사이트에 대한 접근제한
  - 액세스 로그를 획득하는 정책을 철저하게 관리하는 목적
- 캐싱 프록시 (Cashing Proxy)
  - 프록시로 응답을 중계할때는 **프록시 서버상에 리소스 캐시를 보존해두는 타입의 프록시**
  - 프록시에 같은 리소스에 요청이 온경우, 오리진 서버로 부터 리소스를 획득하는 것이 아닌 프록시 서버의 캐시를 응답으로 되돌려준다
- 투명 프록시 (Transparent Proxy)
  - 프록시로 요청과 응답을 중계할때 메세지 변경을 하지 않는 타입
  - 반대로 메세지에 변경을 주는 타입을 비투과 프록시라고 한다

### 5.2.2. 게이트웨이
- 게이트웨이는 그 다음에 있는 서버가 HTTP 프로토콜 이외의 통신을 할 수 있도록 제공하는 서버가 된다
- 클라이언트와 게이트웨이 사이를 암호화하는 등 안전하게 접속함으로써 **통신의 안전성을 높이는 역할**을 한다
<br><br>
- 프록시 서버는 컨텐트 캐시, 보안, 필터링 등의 역할을 하는 중개자라면, 게이트웨이는 서로 다른 네트워크 통신에서 서로 다른 프로토콜을 호환가능하게 하는 특별한 서버라고 볼 수 있을 것 같다.


### 5.2.3. 터널
- 다른 서버와의 통신 경로를 확립한다
- 터널 자체는 HTTP 리퀘스트를 해석하려고 하지 않고, 리퀘스트를 그대로 다음 서버에 중계한다
- 터널은 통신하는 양쪽 끝의 접속이 끊어질때 종료된다 

## 5.3. 리소스를 보관하는 캐시
- 캐시를 사용하면 리소스를 가진 서버에 액세스를 줄이는 것이 가능하므로 **통신량, 통신시간을 절약할 수 있다**
- 캐시 서버는 프록시 서버의 하나로 캐싱 프록시로 분류된다
- 프록시 서버 상에 리소스의 사본을 보존한다

### 5.3.1. 캐시는 유효기간이 있다
- 캐시 서버에 캐시가 있더라도, 같은 리소스의 리퀘스트에 대해 항상 캐시를 돌려준다고 할 수는 없다
  - 이것은 캐시되어 있는 리소스의 유효성과 관계가 있다
- 같은 캐시를 계속 사용하고 있다보면 오리진 서버에 있는 원래 리소스가 갱신되는 경우가 있는데, 이 때 캐시 서버는 갱신되기 전의 낡은 리소스를 그대로 보내게 된다
- 클라이언트의 요구나 캐시의 유효기간 등에 의해 오리진 서버에 리소스의 유효성을 확인하거나, 새로운 리소스를 다시 획득하러 가게되는 경우가 있다

### 5.3.2. 클라이언트 측에도 캐시가 있다
- 인터넷 익스플로러에서 클라이언트가 보존하는 캐시를 인터넷 임시 파일이라고 부른다
- 브라우저가 유효한 캐시를 가지고 있는 경우, 서버에 액세스하지 않고 로컬 디스크로부터 불러온다
