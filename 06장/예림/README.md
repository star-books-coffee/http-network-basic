# 6장. HTTP 헤더

## 6.7 쿠키를 위한 헤더 필드
- 쿠키가 호출되었을 때는 쿠키의 유효 기한과 송신지의 도메인, 경로, 프로토콜 등을 체크하는 것이 가능하기 때문에, 적절하게 발행된 쿠키는 다른 웹 사이트의 공격자에 의해 데이터가 도난 당하는 일이 없다.

### 6.7.1 Set-Cookie

```
Set-Cookie: status-enable: expires=Tue, 05 Jul 2011 07:26:31 GMT;=>path:/;domain=.hack.jp;
```

- 서버가 클라이언트에 대해서 상태 관리를 시작할 때 다양한 정보를 전달한다. 필드 값에는 다음과 같은 정보가 기술된다.

| 속성 | 설명                     |
| --- | ----------------------- |
| NAME=VALUE | 쿠키에 부여된 이름과 값(필수) |
| Expires=DATE | 쿠키 유효 기간(지정되지 않은 경우는 브라우저를 닫을 때까지) |
| Path=PATH | 쿠키 적용 대상이 되는 서버 상의 디렉토리 (지정하지 않은 경우는 도큐먼트와 같은 디렉토리) |
| Domain=도메인명 | 쿠키 적용 대상이 되는 도메인 명(지정하지 않은 경우는 쿠키를 생성한 서버의 도메인) |
| Secure | HTTPS로 통신하고 있는 경우에만 쿠키를 통신 |
| HttpOnly | 쿠키를 JavaScript에서 액세스하지 못하도록 제한 |


#### 1) Expires 속성
- 한 번 서버에 송출한 클라이언트의 쿠키는 서버에서 명시적으로 삭제하는 방법은 없다.
- 유효 기한이 지났다면 쿠키를 덮어 쓰는 것으로 실질적인 클라이언트 측의 쿠키 삭제 가능

#### 2) Path 속성
- 쿠키를 송출하는 범위를 특정 디렉토리에 한정 가능
- 이 지정을 피하는 방법이 있어 보안 효과는 기대할 수 없음

#### 3) Domain 속성
- 이 속성에 의해서 지정된 도메인 명은 **후방 일치**가 된다.
- 예를 들면, "example.com"로 지정했을 때, "www.example.com", "www2.example.com" 등에서도 쿠키송출
- 명시적으로 여러 도메인에 대해서 쿠키를 송출하는 경우를 제외하고 domain 속성은 지정하지 않는 쪽이 안전

#### 4) Secure 속성
- HTTPS에서 열렸을 때만 쿠키 송출 제한
```
Set-Cookie: name=calue; secure
```

#### 5) HttpOnly 속성
- 자바스크립트를 경유해서 쿠키를 취득하지 못하도록 한다.
- 크로스 사이트 스크립팅(XSS)으로부터 쿠키의 도청을 막는 것을 목적으로 한다.
```
Set-Cookie: name=calue; HttpOnly
```
- 위의 경우, 통상 웹 페이지 내에서 쿠키를 읽어 들이는 것은 가능하지만 HttpOnly 속성이 부여된 쿠키는 JavaScript의 `document.cookie`에서는 읽어들일 수 없다.
- 현재 주요 브라우저에서는 거의 모두 대응하고 있음. XSS 자체를 막는 것은 아님.


### 6.7.2 Cookie
```
Cookie: status=enable
```

- 클라이언트가 HTTP의 상태 관리 자원을 원할 때 서버로부터 수신한 쿠키를 이후의 리퀘스트에 포함해서 전달
- 쿠키를 여러 개 수신하고 있을 때에는 쿠키를 여러 개 보내는 것도 가능
