# 제 7장. 웹을 안전하게 지켜주는 HTTPS
## 7.1. HTTP 의 약점
- 평문 (암호화 하지 않은) 통신이기에 `도청 가능`
- 통신 상대를 확인하지 않기에 `위장 가능`
- 완전성을 증명할 수 없기에 `변조 가능`

### 7.1.1. 평문이기 때문에 도청 가능
- HTTP 를 사용한 리퀘스트/리스폰스 통신 내용은 **HTTP 자신을 암호화하는 기능은 없기에 통신 전체가 암호화 되지 않는다**
  - 즉, 평문 (암호화 되지 않은 메시지) 로 HTTP 메시지를 보내게 된다

#### TCP/IP 는 도청 가능한 네트워크
- TCP/IP 구조의 통신 내용은 **전부 통신 경로의 도중에 엿볼 수 있다**
- 통신 내용을 엿볼 수 있다는 것은, 암호화된 통신 / 암호화 되지 않은 통신 모두 동일하다
  - 암호화 통신은 메시지 속 의미는 간파할 수 없지만, 암호화된 메시지 자체는 엿볼 수 있다
- 인터넷은 모든 곳에서 통신 내용이 도청될 가능성이 있다
- 네트워크 상을 흐르고 있는 패킷을 수집하는 것만으로도 도청할 수 있다
  - 패킷을 수집하려면 패킷을 해석하는 패킷 캡처나 스니퍼 툴을 사용한다

#### 암호화로 도청을 피하다
1) 통신 암호화
- HTTP 에는 암호화 구조가 없지만 **SSL (Secure Socket Layer), TLS (Transport Layer Security) 라는 다른 프로토콜을 조합함으로써 HTTP 통신 내용을 암호화** 할 수 있다
- SSL 등을 이용해 안전한 통신로를 확립하고 나서 HTTP 통신을 한다
- SSL 을 조합한 HTTP 를 HTTPS (HTTP Secure) 나 HTTP over SSL 이라 불린다
2) 콘텐츠 암호화
- 통신하고 있는 **콘텐츠 내용 자체를 암호화**한다
- HTTP 에 암호화 기능이 없기에 HTTP 를 사용해서 운반하는 내용을 암호화하는 것이다
- 물론, 콘텐츠 암호화를 유효하게 하려면 클라이언트/서버가 콘텐츠 암호화/복호화 구조를 가지고 있어야 한다.
  - 평상시에 유저가 사용하는 브라우저와 웹 서버에서는 이용하기 어렵다

### 7.1.2. 통신 상대를 확인하지 않기 때문에 위장 가능
- **HTTP 를 사용한 리퀘스트/리스폰스에서는 통신 상대를 확인하지 않는다**

#### 누구나 리퀘스트할 수 있다
- HTTP 에 의한 통신에는 상대가 누구인지 확인하는 처리는 없기에 누구든지 리퀘스트를 보낼 수 있다
- 또한 리퀘스트가 오면, 상대가 누구든지 무언가의 리스폰스를 반환한다
- 약점
  - 위장한 웹 서버일 수 있다 (리퀘스트를 보낸 곳의 웹 서버 != 리스폰스를 보낸 웹 서버)
  - 위장한 클라이언트일 수 있다 (리스폰스 반환 한 곳의 클라이언트 != 리퀘스트를 보낸 클라이언트)
  - 통신하고 있는 상대가 접근 허가된 상대인지 확인할 수 없다
  - 의미없는 리퀘스트라도 수신하게 된다. 따라서 대량 리퀘스트에 의한 DoS 공격 (서비스 불능 공격)을 방지할 수 없다

#### 상대를 확인하는 증명서
- HTTP 에서는 통신 상대를 확인할 수 없지만 SSL 로 상대를 확인할 수 있다
- **SSL 은 암호화뿐만 아니라 상대를 확인하는 수단으로 증명서를 제공**한다
  - 증명서는 신뢰할 수 있는 제 3자 기관에 의해 발행되기에, 서버나 클라이언트가 실재함을 증명한다
  - 증명서를 위조하는 것은 기술적으로 굉장히 어렵다
- **통신 상대의 서버나 클라이언트가 가진 증명서를 확인함으로써, 통신 상대가 내가 통신하고자 하는 상대인지 여부를 판단할 수 있다**

### 7.1.3. 완전성을 증명할 수 없기 때문에 변조 가능
- 완전성 : 정보의 정확성
  - 완전성을 증명할 수 없다 == 정보가 정확한지 아닌지를 확인할 수 없다

#### 수신한 내용이 다를지도 모른다
- 만약 **리퀘스트, 리스폰스가 발신된 후에 상대가 수신할 때까지 변조되었다고 해도 이 사실을 알 수 없다**
- 중간자 공격 (Man-in-the-Middle) : 공격자가 도중에 리퀘스트/리스폰스를 빼앗아 변조하는 공격

#### 변조를 방지하려면?
- MD5 나 SHA-1 등의 해시 값을 확인하는 방법과 파일의 디지털 서명을 확인하는 방법이 존재한다
- 파일 다운로드 서비스를 제공하는 웹사이트에서는 PGP (Pretty Good Privacy) 에 의한 서명와 MD5에 의한 해시값을 제공한다
  - PGP : 파일을 작성했다는 증명을 위한 서명
  - MD5 : 단방향성 함수에 의한 해시 값
  - 어느쪽을 사용하더라도 클라이언트를 이용하고 있는 유저 자신이 다운로드 받은 파일을 토대로 검사해야 한다
- 아쉽게 이 방법으로 확실히 확인할 수는 없다. 
  - PGP, MD5 자체도 적절히 수정되어 있으면 유저로서는 알 방법이 없다
- 확실히 방지하기 위해서 HTTPS 를 사용해야 한다
  - **SSL 에는 인증, 암호화, 다이제스트 기능을 제공한다**
    - 암호화 : 정해직 규칙에 근거하여 데이터를 변환하는 기술 (도청 방지)
    - 메시지 다이제스트 (메시지 압축 알고리즘) : 데이터로부터 고정 길이 데이터를 꺼내는 계산 (변조 방지)
    - 디지털 증명서 : 통신을 하는 상태가 원하는 상대인지를 증명하는 파일 (위장 방지)
  - HTTP 만으로는 완전성을 보증하기 어렵기 때문에 다른 프로토콜을 조합함으로써 실현하고 있다